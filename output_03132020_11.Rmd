---
title: "output_03132020_11"
author: "Young-Kyung Kim"
date: "3/13/2021"
output: pdf_document
---

```{r setup, include=FALSE}
```

## Data cleaning

```{r}
df <- read.csv(file="Master_Coding_CSV_03132020_19.csv", header=TRUE, sep=',', stringsAsFactors = FALSE)
#detect whether something has two languages of similar prominence
#set all null values to numbers so that the if-else doesn't fail early 
df$kor_hier <- strtoi(ifelse(df$kor_hier == FALSE, 100, df$kor_hier))
df$eng_hier <- strtoi(ifelse(df$eng_hier == FALSE, 200, df$eng_hier))
df$other_hier <- strtoi(ifelse(df$other_hier == FALSE, 300, df$other_hier))
#how big is the biggest text on a sign?
df$prom_size <- pmin(df$kor_hier, df$eng_hier, df$other_hier)
#this is just a check for now; shouldn't be a problem after I fix the dataset. For now, exclude these rows.
df$prom_lang_matched <- ifelse(df$eng_hier == df$kor_hier, FALSE, ifelse(df$kor_hier == df$other_hier, FALSE, ifelse(df$other_hier == df$eng_hier, FALSE, TRUE)))
#if there are 2+ scripts, which script is more prominent?
df$prom_lang <- ifelse(df$prom_size > 50, NA, (ifelse(df$kor_hier == df$prom_size, 'han', ifelse(df$eng_hier == df$prom_size, 'roman', 'other'))))
#set the right ones to factor variables
df[c("type_loan", "type_loan_2", "type_loan_3")] <- lapply(df[c("type_loan", "type_loan_2", "type_loan_3")], as.factor)
levels(df$type_loan) <- c("1", "2", "3", "4", "5")
levels(df$type_loan_2) <- c("1", "2", "3", "4", "5")
levels(df$type_loan_3) <- c("1", "2", "3", "4", "5")
#if there is one script, which one is it? factor variables 
df$lang <- ifelse(df$prom_size > 50, 
                  ifelse(df$kor_check == 1, 1, 
                  ifelse(df$eng_check == 1, 2, 
                  ifelse(!is.na(df$chinese), 3, 
                  ifelse(!is.na(df$japanese), 4,
                  ifelse(!is.na(df$span), 5,
                  ifelse(!is.na(df$fren), 6, 
                  ifelse(!is.na(df$arabic), 7, 
                  ifelse(!is.na(df$viet), 8,
                  ifelse(!is.na(df$thai), 9,
                  ifelse(!is.na(df$turkish), 10, -9)))))))))),NA)
#assign binary location variable
df$location <- ifelse(df$point_id < 58, 1, 0)
#remove rows where prominence is matched between two scripts 
df <- df[df$prom_lang_matched == TRUE,]
#create df for calculating relative area 
df['prom_lang_matched'] <- NULL
df_area <- df
#c("How many different sites?", length(unique(df$site_id)))
#c("How many different points?", length(unique(df$point_id)))
```

```{r}
#prepping sign and size df
for (i in unique(df$site_id)) {
  same_site <- df$site_id == i
  same_sign <- (df$sign_id == df$sign_id) & (same_site)
  same_sign <- ifelse(is.na(same_sign), FALSE, same_sign)
  #number of true
  p = df[same_sign==TRUE, ]
  same_sign[strtoi(rownames(p)[which.min(p$prom_size)])] = FALSE
  if (length(which(same_sign)) == 0) next
  df = df[-c(which(same_sign)),]
}
#create df for calculating signs
df_sign <- df
```

## SCRIPTS BY SIGN
```{r}
#hand-coding this first table and it's really atrocious 
total_signs <- nrow(df_sign)
koreatown_signs <- df_sign[df_sign$location == 0, ]
itaewon_signs <- df_sign[df_sign$location == 1, ]
koreatown_total <- nrow(koreatown_signs)
itaewon_total <- nrow(itaewon_signs)
koreatown_hangeul <- sum(koreatown_signs$lang == 1, na.rm=TRUE)
koreatown_english <- sum(koreatown_signs$lang == 2, na.rm=TRUE)
koreatown_other <- sum(koreatown_signs$lang > 2, na.rm=TRUE)
koreatown_mixed <- sum(!is.na(koreatown_signs$prom_lang), na.rm=TRUE)
itaewon_hangeul <- sum(itaewon_signs$lang == 1, na.rm=TRUE)
itaewon_english <- sum(itaewon_signs$lang == 2, na.rm=TRUE)
itaewon_other <- sum(itaewon_signs$lang > 2, na.rm=TRUE)
itaewon_mixed <- sum(!is.na(itaewon_signs$prom_lang), na.rm=TRUE)
koreatown_sum <- sum(koreatown_hangeul,koreatown_english,koreatown_other,koreatown_mixed)
itaewon_sum <- sum(itaewon_hangeul+itaewon_english+itaewon_other+itaewon_mixed)

table_sign <- data.frame(c(koreatown_hangeul, itaewon_hangeul, sum(koreatown_hangeul, itaewon_hangeul)), 
                         c(koreatown_hangeul/koreatown_total, itaewon_hangeul/itaewon_total, ''),
                         c(koreatown_english, itaewon_english, sum(koreatown_english, itaewon_english)), 
                         c(koreatown_english/koreatown_total, itaewon_english/itaewon_total, ''),
                         c(koreatown_other, itaewon_other, sum(koreatown_other, itaewon_other)), 
                         c(koreatown_other/koreatown_total, itaewon_other/itaewon_total, ''), 
                         c(koreatown_mixed, itaewon_mixed, sum(koreatown_mixed, itaewon_mixed)),
                         c(koreatown_mixed/koreatown_total, itaewon_mixed/itaewon_total, ''),
                         c(koreatown_sum, itaewon_sum, sum(koreatown_sum, itaewon_sum)),
                         c(koreatown_total, itaewon_total, total_signs))

names(table_sign) <- c('h_int', 'h_prop', 'e_int', 'e_prop', 'o_int', 'o_prop', 'm_int', 'm_prop', 'temp_totals', 'total')
```

## A more efficient way to code tables
```{r}
mat <- matrix(, nrow = 15, ncol = n.columns)
koreatown_signs[c("point_id", "sign_id", "site_description", "location")] <- NULL
library(dplyr)
d <- koreatown_signs %>% count(type_loan)
f <- itaewon_signs %>% count(type_loan)
t(d)
t(f)
itaewon_signs[c("point_id", "sign_id", "site_description", "location")] <- NULL

koreatown_signs
```

## Tests of different proportions 
```{r}
#test for proportions of Korean
t.test(c(rep(1, koreatown_hangeul), rep(0, koreatown_sum)), c(rep(1, itaewon_hangeul), rep(0, itaewon_sum)))
```
## Basic descriptive statistics
```{r}

df[df$prom_size == 30,]
library(dplyr)
df_area %>% count()
# BASED ON WORDS
# Total number of unique signs, total number of unique signs in Itaewon and Koreatown
# Total number of sites, total number of sites in both neighbors
# Average number of words per sign 

# test differences

# AND ALSO BASED ON SIZE
# Total area taken up by text, total area of unique signs in Itaewon and Koreatown
# Average area per sign, average area per site
# Average number of words by size

# test differences
```

## Relative scripts
```{r}
# BASED ON SIGNS, SIZE
# Proportion of dominant scripts
# Proportion of mixed-script signs, single script signs, and relative dominance of langauges within that

# test differences in proportions (ANOVA)?
```

## Loanwords
```{r}
# BASED ON SIGNS 

# BASED ON SIZE 
# parsing for the different loanwords 
library(stringr)
loanwords <- df$word_loan[!is.na(df$word_loan) & (df$word_loan != "")]
loanwords_2 <- df$words_loan_2[!is.na(df$words_loan_2) & (df$words_loan_2 != "")]
loanwords_3 <- df$words_loan_3[!is.na(df$words_loan_3) & (df$words_loan_3 != "")]
loanwords <- c(loanwords, loanwords_2, loanwords_3)
loanwords <- unlist(str_split(loanwords, ", "))
unique_loanwords <- unique(loanwords)
```
## 